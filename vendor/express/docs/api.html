<html>
	<head>
		<title>Express</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px 40px 30px 40px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px 0 30px 40px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    cursor: pointer;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }</style>
		<script>
			$(function(){
				$('tr.code').hide();
				$('tr.filename').toggle(function(){
					$(this).nextUntil('.filename').fadeIn();
				}, function(){
					$(this).nextUntil('.filename').fadeOut();
				});
			});
		</script>
	</head>
	<body>
<table id="source"><tbody><tr><td><h1>Express</h1><p>High performance web framework for <a href="http://nodejs.org">node</a>.</p></td><td></td></tr><tr class="filename"><td><h2 id="lib/express/index.js"><a href="#">index</a></h2></td><td>lib/express/index.js</td></tr><tr class="code">
<td class="docs">
<p>Re-export connect auto-loaders.</p>

<p>This prevents the need to <code>require('connect')</code> in order
to access core middleware, so for example <code>express.logger()</code> instead
of <code>require('connect').logger()</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="variable">require</span>(<span class="string">'connect'</span>).<span class="variable">middleware</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Framework version.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">version</span> = <span class="string">'1.0.0rc'</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Server</span> = <span class="variable">exports</span>.<span class="class">Server</span> = <span class="variable">require</span>(<span class="string">'./server'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Shortcut for <code>new Server(...)</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  ...</p></li><li><p><strong>return</strong>: <em>Server</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">createServer</span> = <span class="keyword">function</span>(){
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="class">Server</span>(<span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>View extensions.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">require</span>(<span class="string">'./view'</span>);
<span class="variable">require</span>(<span class="string">'./request'</span>);
<span class="variable">require</span>(<span class="string">'./response'</span>);
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/express/request.js"><a href="#">request</a></h2></td><td>lib/express/request.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">http</span> = <span class="variable">require</span>(<span class="string">'http'</span>),
    <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'./utils'</span>),
    <span class="variable">mime</span> = <span class="variable">require</span>(<span class="string">'connect/utils'</span>).<span class="variable">mime</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Return request header or optional default.</p>

<h2>Examples</h2>

<pre><code>req.header('Content-Type');
// =&gt; "text/plain"

req.header('content-type');
// =&gt; "text/plain"

req.header('Accept');
// =&gt; undefined

req.header('Accept', 'text/html');
// =&gt; "text/html"</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>String</em>  defaultValue</p></li><li><p><strong>return</strong>: <em>String</em>  </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">IncomingMessage</span>.<span class="variable">prototype</span>.<span class="variable">header</span> = <span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">defaultValue</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">headers</span>[<span class="variable">name</span>.<span class="variable">toLowerCase</span>()] || <span class="variable">defaultValue</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if the <em>Accept</em> header is present, and includes the given <code>type</code>.</p>

<p>When the <em>Accept</em> header is not present <code>true</code> is returned. Otherwise
the given <code>type</code> is matched by an exact match, and then subtypes. You
may pass the subtype such as "html" which is then converted internally
to "text/html" using the mime lookup table.</p>

<h2>Examples</h2>

<pre><code>// Accept: text/html
req.accepts('html');
// =&gt; true

// Accept: text/*; application/json
req.accepts('html');
req.accepts('text/html');
req.accepts('text/plain');
req.accepts('application/json');
// =&gt; true

req.accepts('image/png');
req.accepts('png');
// =&gt; false</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">IncomingMessage</span>.<span class="variable">prototype</span>.<span class="variable">accepts</span> = <span class="keyword">function</span>(<span class="variable">type</span>){
    <span class="keyword">var</span> <span class="variable">accept</span> = <span class="this">this</span>.<span class="variable">header</span>(<span class="string">'Accept'</span>);
    <span class="keyword">if</span> (!<span class="variable">accept</span> || <span class="variable">accept</span> === '*</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>') {
        return true;
    } else if (type) {
        // Allow "html" vs "text/html" etc
        if (type.indexOf('/') &lt; 0) {
            type = mime.types['.' + type];
        }
        // Check if we have a direct match
        if (accept.indexOf(type) &gt;= 0) {
            return true;
        // Check if we have type/<em>
        } else {
            type = type.split('/')[0] + '/</em>';
            return accept.indexOf(type) &gt;= 0;
        }
    } else {
        return false;
    }
};</p>

<p>/**
Return the value of param <code>name</code> when present.</p>

<ul><li>Checks route placeholders, ex: <em>/user/:id</em></li><li>Checks query string params, ex: ?id=12</li><li>Checks urlencoded body params, ex: id=12</li></ul>

<p>To utilize urlencoded request bodies, <code>req.body</code>
should be an object. This can be done by using
the <code>connect.bodyDecoder</code> middleware.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">IncomingMessage</span>.<span class="variable">prototype</span>.<span class="variable">param</span> = <span class="keyword">function</span>(<span class="variable">name</span>){
    <span class="comment">// Route params like /user/:id</span>
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">params</span>[<span class="variable">name</span>] !== <span class="variable">undefined</span>) {
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">params</span>[<span class="variable">name</span>]; 
    }
    <span class="comment">// Query string params</span>
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">query</span>[<span class="variable">name</span>] !== <span class="variable">undefined</span>) {
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">query</span>[<span class="variable">name</span>]; 
    }
    <span class="comment">// Request body params via connect.bodyDecoder</span>
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">body</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="this">this</span>.<span class="variable">body</span>[<span class="variable">name</span>] !== <span class="variable">undefined</span>) {
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">body</span>[<span class="variable">name</span>];
    }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Queue flash <code>msg</code> of the given <code>type</code>.</p>

<h2>Examples</h2>

<pre><code> req.flash('info', 'email sent');
 req.flash('error', 'email delivery failed');
 req.flash('info', 'email re-sent');
 // =&gt; 2

 req.flash('info');
 // =&gt; ['email sent', 'email re-sent']

 req.flash('info');
 // =&gt; []

 req.flash();
 // =&gt; { error: ['email delivery failed'], info: [] }</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>param</strong>: <em>String</em>  msg</p></li><li><p><strong>return</strong>: <em>Array | Object | Number</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">IncomingMessage</span>.<span class="variable">prototype</span>.<span class="variable">flash</span> = <span class="keyword">function</span>(<span class="variable">type</span>, <span class="variable">msg</span>){
    <span class="keyword">var</span> <span class="variable">msgs</span> = <span class="this">this</span>.<span class="variable">session</span>.<span class="variable">flash</span> = <span class="this">this</span>.<span class="variable">session</span>.<span class="variable">flash</span> || {};
    <span class="keyword">if</span> (<span class="variable">type</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">msg</span>) {
        <span class="variable">msg</span> = <span class="variable">utils</span>.<span class="variable">miniMarkdown</span>(<span class="variable">utils</span>.<span class="variable">htmlEscape</span>(<span class="variable">msg</span>));
        <span class="keyword">return</span> (<span class="variable">msgs</span>[<span class="variable">type</span>] = <span class="variable">msgs</span>[<span class="variable">type</span>] || []).<span class="variable">push</span>(<span class="variable">msg</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">type</span>) {
        <span class="keyword">var</span> <span class="variable">arr</span> = <span class="variable">msgs</span>[<span class="variable">type</span>];
        <span class="keyword">delete</span> <span class="variable">msgs</span>[<span class="variable">type</span>];
        <span class="keyword">return</span> <span class="variable">arr</span> || [];
    } <span class="keyword">else</span> {
        <span class="this">this</span>.<span class="variable">session</span>.<span class="variable">flash</span> = {};
        <span class="keyword">return</span> <span class="variable">msgs</span>;
    }
};

<span class="comment">// Callback for isXMLHttpRequest / xhr</span>

<span class="keyword">function</span> <span class="variable">isxhr</span>() {
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">header</span>(<span class="string">'X-Requested-With'</span>, <span class="string">''</span>).<span class="variable">toLowerCase</span>() === <span class="string">'xmlhttprequest'</span>;
}</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Check if the request was an <em>XMLHttpRequest</em>.</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">IncomingMessage</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'isXMLHttpRequest'</span>, <span class="variable">isxhr</span>);
<span class="variable">http</span>.<span class="class">IncomingMessage</span>.<span class="variable">prototype</span>.<span class="variable">__defineGetter__</span>(<span class="string">'xhr'</span>, <span class="variable">isxhr</span>);</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/express/response.js"><a href="#">response</a></h2></td><td>lib/express/response.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">fs</span> = <span class="variable">require</span>(<span class="string">'fs'</span>),
    <span class="variable">http</span> = <span class="variable">require</span>(<span class="string">'http'</span>),
    <span class="variable">path</span> = <span class="variable">require</span>(<span class="string">'path'</span>),
    <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'connect/utils'</span>),
    <span class="variable">mime</span> = <span class="variable">require</span>(<span class="string">'connect/utils'</span>).<span class="variable">mime</span>,
    <span class="class">Buffer</span> = <span class="variable">require</span>(<span class="string">'buffer'</span>).<span class="class">Buffer</span>;</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Send a response with the given <code>body</code> and optional <code>headers</code> and <code>status</code> code.</p>

<h2>Examples</h2>

<pre><code>res.send(new Buffer('wahoo'));
res.send({ some: 'json' });
res.send('&lt;p&gt;some html&lt;/p&gt;');
res.send('Sorry, cant find that', 404);
res.send('text', { 'Content-Type': 'text/plain' }, 201);
res.send(404);</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | Object | Number | Buffer</em>  body or status</p></li><li><p><strong>param</strong>: <em>Object | Number</em>  headers or status</p></li><li><p><strong>param</strong>: <em>Number</em>  status</p></li><li><p><strong>return</strong>: <em>ServerResponse</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">send</span> = <span class="keyword">function</span>(<span class="variable">body</span>, <span class="variable">headers</span>, <span class="variable">status</span>){
    <span class="comment">// Allow status as second arg</span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">headers</span> === <span class="string">'number'</span>) {
        <span class="variable">status</span> = <span class="variable">headers</span>,
        <span class="variable">headers</span> = <span class="keyword">null</span>;
    }

    <span class="comment">// Defaults</span>
    <span class="variable">status</span> = <span class="variable">status</span> || <span class="number integer">200</span>;
    <span class="variable">headers</span> = <span class="variable">headers</span> || {};

    <span class="comment">// Determine content type</span>
    <span class="keyword">switch</span> (<span class="keyword">typeof</span> <span class="variable">body</span>) {
        <span class="keyword">case</span> <span class="string">'number'</span>:
            <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">headers</span>[<span class="string">'Content-Type'</span>]) {
                <span class="this">this</span>.<span class="variable">contentType</span>(<span class="string">'.txt'</span>);
            }
            <span class="variable">body</span> = <span class="variable">http</span>.<span class="class">STATUS_CODES</span>[<span class="variable">status</span> = <span class="variable">body</span>];
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string">'string'</span>:
            <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">headers</span>[<span class="string">'Content-Type'</span>]) {
                <span class="this">this</span>.<span class="variable">contentType</span>(<span class="string">'.html'</span>);
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string">'object'</span>:
            <span class="keyword">if</span> (<span class="variable">body</span> <span class="variable">instanceof</span> <span class="class">Buffer</span>) {
                <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">headers</span>[<span class="string">'Content-Type'</span>]) {
                    <span class="this">this</span>.<span class="variable">contentType</span>(<span class="string">'.bin'</span>);
                }
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">headers</span>[<span class="string">'Content-Type'</span>]) {
                    <span class="this">this</span>.<span class="variable">contentType</span>(<span class="string">'.json'</span>);
                }
                <span class="variable">body</span> = <span class="class">JSON</span>.<span class="variable">stringify</span>(<span class="variable">body</span>);
            }
            <span class="keyword">break</span>;
    }

    <span class="comment">// Populate Content-Length</span>
    <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">headers</span>[<span class="string">'Content-Length'</span>]) {
        <span class="this">this</span>.<span class="variable">header</span>(<span class="string">'Content-Length'</span>, <span class="variable">body</span> <span class="variable">instanceof</span> <span class="class">Buffer</span>
            ? <span class="variable">body</span>.<span class="variable">length</span>
            : <span class="class">Buffer</span>.<span class="variable">byteLength</span>(<span class="variable">body</span>));
    }

    <span class="comment">// Merge headers passed</span>
    <span class="variable">utils</span>.<span class="variable">merge</span>(<span class="this">this</span>.<span class="variable">headers</span>, <span class="variable">headers</span>);

    <span class="comment">// Respond</span>
    <span class="this">this</span>.<span class="variable">writeHead</span>(<span class="variable">status</span>, <span class="this">this</span>.<span class="variable">headers</span>);
    <span class="this">this</span>.<span class="variable">end</span>(<span class="variable">body</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Transfer the file at the given <code>path</code>. Automatically sets 
the <em>Content-Type</em> response header via <code>res.contentType()</code>. </p>

<p>The given callback <code>fn</code> is invoked when an error occurs,
passing it as the first argument, or when the file is transferred,
passing the path as the second argument.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  path</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">sendfile</span> = <span class="keyword">function</span>(<span class="variable">path</span>, <span class="variable">fn</span>){
    <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
    <span class="variable">fs</span>.<span class="variable">readFile</span>(<span class="variable">path</span>, <span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">buf</span>){
        <span class="keyword">if</span> (<span class="variable">err</span>) {
            <span class="keyword">if</span> (<span class="variable">fn</span>) {
                <span class="variable">fn</span>(<span class="variable">err</span>, <span class="variable">path</span>);
            } <span class="keyword">else</span> {
                <span class="variable">self</span>.<span class="variable">req</span>.<span class="variable">next</span>(<span class="variable">err</span>);
            }
        } <span class="keyword">else</span> {
            <span class="variable">self</span>.<span class="variable">contentType</span>(<span class="variable">path</span>);
            <span class="variable">self</span>.<span class="variable">send</span>(<span class="variable">buf</span>);
            <span class="variable">fn</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">fn</span>(<span class="keyword">null</span>, <span class="variable">path</span>);
        }
    });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set <em>Content-Type</em> response header passed through <code>mime.type()</code>.</p>

<h2>Examples</h2>

<pre><code>var filename = 'path/to/image.png';
res.contentType(filename);
// res.headers['Content-Type'] is now "image/png"</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  type</p></li><li><p><strong>return</strong>: <em>String</em>  the resolved mime type</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">contentType</span> = <span class="keyword">function</span>(<span class="variable">type</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">header</span>(<span class="string">'Content-Type'</span>, <span class="variable">mime</span>.<span class="variable">type</span>(<span class="variable">type</span>));
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set <em>Content-Disposition</em> header to <em>attachment</em> with optional <code>filename</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  filename</p></li><li><p><strong>return</strong>: <em>ServerResponse</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">attachment</span> = <span class="keyword">function</span>(<span class="variable">filename</span>){
    <span class="this">this</span>.<span class="variable">header</span>(<span class="string">'Content-Disposition'</span>, <span class="variable">filename</span>
        ? <span class="string">'attachment; filename=&quot;'</span> + <span class="variable">path</span>.<span class="variable">basename</span>(<span class="variable">filename</span>) + <span class="string">'&quot;'</span>
        : <span class="string">'attachment'</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Transfer the file at the given <code>path</code>, with optional 
<code>filename</code> as an attachment. Once transferred, or if an
error occurs <code>fn</code> is called with the error and path.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  path</p></li><li><p><strong>param</strong>: <em>String</em>  filename</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>return</strong>: <em>Type</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">download</span> = <span class="keyword">function</span>(<span class="variable">path</span>, <span class="variable">filename</span>, <span class="variable">fn</span>){
    <span class="this">this</span>.<span class="variable">attachment</span>(<span class="variable">filename</span> || <span class="variable">path</span>).<span class="variable">sendfile</span>(<span class="variable">path</span>, <span class="variable">fn</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Set or get response header <code>name</code> with optional <code>val</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  name</p></li><li><p><strong>param</strong>: <em>String</em>  val</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">header</span> = <span class="keyword">function</span>(<span class="variable">name</span>, <span class="variable">val</span>){
    <span class="keyword">return</span> <span class="variable">val</span> === <span class="variable">undefined</span>
        ? <span class="this">this</span>.<span class="variable">headers</span>[<span class="variable">name</span>]
        : <span class="this">this</span>.<span class="variable">headers</span>[<span class="variable">name</span>] = <span class="variable">val</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Redirect to the given <code>url</code> with optional response <code>status</code>
defauling to 302.</p>

<p>The given <code>url</code> can also be the name of a mapped url, for
example by default express supports "back" which redirects
to the <em>Referrer</em> or <em>Referer</em> headers or the application's
"home" setting. Express also supports "home" out of the box,
which can be set via <code>app.set('home', '/blog');</code>, and defaults
to '/'.</p>

<h2>Redirect Mapping</h2>

<p> To extend the redirect mapping capabilities that Express provides,
 we may use the <code>app.redirect()</code> method:</p>

<pre><code>app.redirect('google', 'http://google.com');</code></pre>

<p> Now in a route we may call:</p>

<pre><code>res.redirect('google');</code></pre>

<p> We may also map dynamic redirects:</p>

<pre><code> app.redirect('comments', function(req, res){
     return '/post/' + req.params.id + '/comments';
 });</code></pre>

<p> So now we may do the following, and the redirect will dynamically adjust to
 the context of the request. If we called this route with <em>GET /post/12</em> our
 redirect <em>Location</em> would be <em>/post/12/comments</em>.</p>

<pre><code> app.get('/post/:id', function(req, res){
     res.redirect('comments');
 });</code></pre>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  url</p></li><li><p><strong>param</strong>: <em>Number</em>  code</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">redirect</span> = <span class="keyword">function</span>(<span class="variable">url</span>, <span class="variable">status</span>){
    <span class="keyword">var</span> <span class="variable">basePath</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'home'</span>) || <span class="string">'/'</span>;

    <span class="comment">// Setup redirect map</span>
    <span class="keyword">var</span> <span class="variable">map</span> = {
        <span class="variable">back</span>: <span class="this">this</span>.<span class="variable">req</span>.<span class="variable">headers</span>.<span class="variable">referrer</span> || <span class="this">this</span>.<span class="variable">req</span>.<span class="variable">headers</span>.<span class="variable">referer</span> || <span class="variable">basePath</span>,
        <span class="variable">home</span>: <span class="variable">basePath</span>
    };

    <span class="comment">// Support custom redirect map</span>
    <span class="variable">map</span>.<span class="variable">__proto__</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">redirects</span>;

    <span class="comment">// Attempt mapped redirect</span>
    <span class="keyword">var</span> <span class="variable">mapped</span> = <span class="keyword">typeof</span> <span class="variable">map</span>[<span class="variable">url</span>] === <span class="string">'function'</span>
        ? <span class="variable">map</span>[<span class="variable">url</span>](<span class="this">this</span>.<span class="variable">req</span>, <span class="this">this</span>)
        : <span class="variable">map</span>[<span class="variable">url</span>];

    <span class="comment">// Perform redirect</span>
    <span class="this">this</span>.<span class="variable">writeHead</span>(<span class="variable">status</span> || <span class="number integer">302</span>, { <span class="string">'Location'</span>: <span class="variable">mapped</span> || <span class="variable">url</span> });
    <span class="this">this</span>.<span class="variable">end</span>();
};
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/express/utils.js"><a href="#">utils</a></h2></td><td>lib/express/utils.js</td></tr><tr class="code">
<td class="docs">
<p>Parse mini markdown implementation.
The following conversions are supported,
primarily for the "flash" middleware:</p>

<p>   <em>foo</em> or <em>foo</em> become &lt;em&gt;foo&lt;/em&gt;
   <strong>foo</strong> or <strong>foo</strong> become &lt;strong&gt;foo&lt;/strong&gt;
   <a href="B">A</a> becomes &lt;a href="B"&gt;A&lt;/a&gt;</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  str</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">miniMarkdown</span> = <span class="keyword">function</span>(<span class="variable">str</span>){
    <span class="keyword">return</span> <span class="class">String</span>(<span class="variable">str</span>)
        .<span class="variable">replace</span>(<span class="regexp">/(__|\*\*)(.*?)\1/g</span>, <span class="string">'&lt;strong&gt;$2&lt;/strong&gt;'</span>)
        .<span class="variable">replace</span>(<span class="regexp">/(_|\*)(.*?)\1/g</span>, <span class="string">'&lt;em&gt;$2&lt;/em&gt;'</span>)
        .<span class="variable">replace</span>(<span class="regexp">/\[([^\]]+)\]\(([^)]+)\)/g</span>, <span class="string">'&lt;a href=&quot;$2&quot;&gt;$1&lt;/a&gt;'</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Escape special characters in the given string of html.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  html</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">htmlEscape</span> = <span class="keyword">function</span>(<span class="variable">html</span>) {
    <span class="keyword">return</span> <span class="class">String</span>(<span class="variable">html</span>)
        .<span class="variable">replace</span>(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;'</span>)
        .<span class="variable">replace</span>(<span class="regexp">/&quot;/g</span>, <span class="string">'&quot;'</span>)
        .<span class="variable">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">'&lt;'</span>)
        .<span class="variable">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">'&gt;'</span>);
};</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/express/server.js"><a href="#">server</a></h2></td><td>lib/express/server.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">sys</span> = <span class="variable">require</span>(<span class="string">'sys'</span>),
    <span class="variable">url</span> = <span class="variable">require</span>(<span class="string">'url'</span>),
    <span class="variable">view</span> = <span class="variable">require</span>(<span class="string">'./view'</span>),
    <span class="variable">connect</span> = <span class="variable">require</span>(<span class="string">'connect'</span>),
    <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'connect/utils'</span>),
    <span class="variable">queryString</span> = <span class="variable">require</span>(<span class="string">'querystring'</span>),
    <span class="variable">router</span> = <span class="variable">require</span>(<span class="string">'connect/middleware/router'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Initialize a new <code>Server</code> with optional <code>middleware</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Array</em>  middleware</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="class">Server</span> = <span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="class">Server</span>(<span class="variable">middleware</span>){
    <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>;
    <span class="this">this</span>.<span class="variable">config</span> = {};
    <span class="this">this</span>.<span class="variable">settings</span> = {};
    <span class="this">this</span>.<span class="variable">redirects</span> = {};
    <span class="this">this</span>.<span class="variable">viewHelpers</span> = {};
    <span class="this">this</span>.<span class="variable">dynamicViewHelpers</span> = {};
    <span class="this">this</span>.<span class="variable">errorHandlers</span> = [];
    <span class="variable">connect</span>.<span class="class">Server</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">middleware</span> || []);

    <span class="comment">// Default &quot;home&quot; to / </span>
    <span class="this">this</span>.<span class="variable">set</span>(<span class="string">'home'</span>, <span class="string">'/'</span>);

    <span class="comment">// Set &quot;env&quot; to EXPRESS_ENV or connectEnv.name</span>
    <span class="this">this</span>.<span class="variable">set</span>(<span class="string">'env'</span>,
        <span class="variable">process</span>.<span class="variable">env</span>.<span class="class">EXPRESS_ENV</span> ||
        <span class="variable">process</span>.<span class="variable">connectEnv</span>.<span class="variable">name</span>);

    <span class="comment">// Expose objects to each other</span>
    <span class="this">this</span>.<span class="variable">use</span>(<span class="keyword">function</span>(<span class="variable">req</span>, <span class="variable">res</span>, <span class="variable">next</span>){
        <span class="variable">req</span>.<span class="variable">query</span> = {};
        <span class="variable">res</span>.<span class="variable">headers</span> = {};
        <span class="variable">req</span>.<span class="variable">app</span> = <span class="variable">res</span>.<span class="variable">app</span> = <span class="variable">self</span>;
        <span class="variable">req</span>.<span class="variable">res</span> = <span class="variable">res</span>;
        <span class="variable">res</span>.<span class="variable">req</span> = <span class="variable">req</span>;
        <span class="variable">req</span>.<span class="variable">next</span> = <span class="variable">next</span>;
        <span class="comment">// Assign req.params.get</span>
        <span class="keyword">if</span> (<span class="variable">req</span>.<span class="variable">url</span>.<span class="variable">indexOf</span>(<span class="string">'?'</span>) &<span class="variable">gt</span>; <span class="number integer">0</span>) {
            <span class="keyword">var</span> <span class="variable">query</span> = <span class="variable">url</span>.<span class="variable">parse</span>(<span class="variable">req</span>.<span class="variable">url</span>).<span class="variable">query</span>;
            <span class="variable">req</span>.<span class="variable">query</span> = <span class="variable">queryString</span>.<span class="variable">parse</span>(<span class="variable">query</span>);
        }
        <span class="variable">next</span>();
    });

    <span class="comment">// Use router, expose as app.get(), etc</span>
    <span class="keyword">var</span> <span class="variable">fn</span> = <span class="variable">router</span>(<span class="keyword">function</span>(<span class="variable">app</span>){ <span class="variable">self</span>.<span class="variable">routes</span> = <span class="variable">app</span>; });
    <span class="this">this</span>.<span class="variable">__defineGetter__</span>(<span class="string">'router'</span>, <span class="keyword">function</span>(){
        <span class="this">this</span>.<span class="variable">__usedRouter</span> = <span class="variable">true</span>;
        <span class="keyword">return</span> <span class="variable">fn</span>;
    });
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Inherit from <code>connect.Server</code>.
 </p>
</td>
<td class="code">
<pre><code><span class="variable">sys</span>.<span class="variable">inherits</span>(<span class="class">Server</span>, <span class="variable">connect</span>.<span class="class">Server</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Stack error handler callbacks, then listen on the given
<code>port</code> and <code>host</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Number | String</em>  port</p></li><li><p><strong>param</strong>: <em>String</em>  host</p></li><li><p><strong>return</strong>: <em>Type</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">listen</span> = <span class="keyword">function</span>(){
    <span class="this">this</span>.<span class="variable">errorHandlers</span>.<span class="variable">forEach</span>(<span class="keyword">function</span>(<span class="variable">fn</span>){
        <span class="this">this</span>.<span class="variable">use</span>(<span class="keyword">function</span>(<span class="variable">err</span>, <span class="variable">req</span>, <span class="variable">res</span>, <span class="variable">next</span>){
            <span class="variable">fn</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">arguments</span>);
        });
    }, <span class="this">this</span>);
    <span class="variable">connect</span>.<span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">listen</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">arguments</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Proxy <code>connect.Server#use()</code> to apply settings to
mounted applications.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | Function | Server</em>  route</p></li><li><p><strong>param</strong>: <em>Function | Server</em>  middleware</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">use</span> = <span class="keyword">function</span>(<span class="variable">route</span>, <span class="variable">middleware</span>){
    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">route</span> !== <span class="string">'string'</span>) {
        <span class="variable">middleware</span> = <span class="variable">route</span>, <span class="variable">route</span> = <span class="string">'/'</span>;
    }

    <span class="variable">connect</span>.<span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">use</span>.<span class="variable">call</span>(<span class="this">this</span>, <span class="variable">route</span>, <span class="variable">middleware</span>);

    <span class="comment">// Mounted an app</span>
    <span class="keyword">if</span> (<span class="variable">middleware</span> <span class="variable">instanceof</span> <span class="class">Server</span>) {
        <span class="comment">// Home is /:route/:home</span>
        <span class="keyword">var</span> <span class="variable">app</span> = <span class="variable">middleware</span>,
            <span class="variable">home</span> = <span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'home'</span>);
        <span class="keyword">if</span> (<span class="variable">home</span> === <span class="string">'/'</span>) <span class="variable">home</span> = <span class="string">''</span>;
        <span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'home'</span>, (<span class="variable">app</span>.<span class="variable">route</span> || <span class="string">''</span>) + <span class="variable">home</span>);
        <span class="comment">// Mounted hook</span>
        <span class="keyword">if</span> (<span class="variable">app</span>.<span class="variable">__mounted</span>) <span class="variable">app</span>.<span class="variable">__mounted</span>.<span class="variable">call</span>(<span class="variable">app</span>, <span class="this">this</span>);
    }

    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assign a callback <code>fn</code> which is called
when this <code>Server</code> is passed to <code>Server#use()</code>.</p>

<h2>Examples</h2>

<p>   var app = express.createServer(),
       blog = express.createServer();</p>

<p>   blog.mounted(function(parent){
       // parent is app
       // "this" is blog
   });</p>

<p>   app.use(blog);</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">mounted</span> = <span class="keyword">function</span>(<span class="variable">fn</span>){
    <span class="this">this</span>.<span class="variable">__mounted</span> = <span class="variable">fn</span>;
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<h2>See view.register.</h2>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">register</span> = <span class="keyword">function</span>(){
    <span class="variable">view</span>.<span class="variable">register</span>.<span class="variable">apply</span>(<span class="this">this</span>, <span class="variable">arguments</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Register the given view helpers <code>obj</code>. This method
can be called several times to apply additional helpers.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  obj</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">helpers</span> = <span class="keyword">function</span>(<span class="variable">obj</span>){
    <span class="variable">utils</span>.<span class="variable">merge</span>(<span class="this">this</span>.<span class="variable">viewHelpers</span>, <span class="variable">obj</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Register the given dynamic view helpers <code>obj</code>. This method
can be called several times to apply additional helpers.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Object</em>  obj</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">dynamicHelpers</span> = <span class="keyword">function</span>(<span class="variable">obj</span>){
    <span class="variable">utils</span>.<span class="variable">merge</span>(<span class="this">this</span>.<span class="variable">dynamicViewHelpers</span>, <span class="variable">obj</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assign a custom exception handler callback <code>fn</code>.
These handlers are always <em>last</em> in the middleware stack.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">error</span> = <span class="keyword">function</span>(<span class="variable">fn</span>){
    <span class="this">this</span>.<span class="variable">errorHandlers</span>.<span class="variable">push</span>(<span class="variable">fn</span>);
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Assign <code>setting</code> to <code>val</code>, or return <code>setting</code>'s value.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  setting</p></li><li><p><strong>param</strong>: <em>String</em>  val</p></li><li><p><strong>return</strong>: <em>Server | Mixed</em>  for chaining, or the setting value</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">set</span> = <span class="keyword">function</span>(<span class="variable">setting</span>, <span class="variable">val</span>){
    <span class="keyword">if</span> (<span class="variable">val</span> === <span class="variable">undefined</span>) {
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">settings</span>[<span class="variable">setting</span>];
    } <span class="keyword">else</span> {
        <span class="this">this</span>.<span class="variable">settings</span>[<span class="variable">setting</span>] = <span class="variable">val</span>;
        <span class="keyword">return</span> <span class="this">this</span>;
    }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Enable <code>setting</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  setting</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">enable</span> = <span class="keyword">function</span>(<span class="variable">setting</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">set</span>(<span class="variable">setting</span>, <span class="variable">true</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Disable <code>setting</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  setting</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">disable</span> = <span class="keyword">function</span>(<span class="variable">setting</span>){
    <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">set</span>(<span class="variable">setting</span>, <span class="variable">false</span>);
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Redirect <code>key</code> to <code>url</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  key</p></li><li><p><strong>param</strong>: <em>String</em>  url</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">redirect</span> = <span class="keyword">function</span>(<span class="variable">key</span>, <span class="variable">url</span>){
    <span class="this">this</span>.<span class="variable">redirects</span>[<span class="variable">key</span>] = <span class="variable">url</span>;
    <span class="keyword">return</span> <span class="this">this</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Configure callback for the given <code>env</code>.</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  env</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>return</strong>: <em>Server</em>  for chaining</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="class">Server</span>.<span class="variable">prototype</span>.<span class="variable">configure</span> = <span class="keyword">function</span>(<span class="variable">env</span>, <span class="variable">fn</span>){
    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">env</span> === <span class="string">'function'</span>) {
        <span class="variable">fn</span> = <span class="variable">env</span>, <span class="variable">env</span> = <span class="string">'all'</span>;
    }
    <span class="keyword">if</span> (<span class="variable">env</span> === <span class="string">'all'</span> || <span class="this">this</span>.<span class="variable">set</span>(<span class="string">'env'</span>) === <span class="variable">env</span>) {
        <span class="variable">fn</span>.<span class="variable">call</span>(<span class="this">this</span>);
    }
    <span class="keyword">return</span> <span class="this">this</span>;
};

<span class="comment">// Generate routing methods</span>

(<span class="keyword">function</span>(<span class="variable">method</span>){
    <span class="class">Server</span>.<span class="variable">prototype</span>[<span class="variable">method</span>] = <span class="keyword">function</span>(<span class="variable">path</span>, <span class="variable">fn</span>){
        <span class="keyword">if</span> (!<span class="this">this</span>.<span class="variable">__usedRouter</span>) {
            <span class="this">this</span>.<span class="variable">use</span>(<span class="this">this</span>.<span class="variable">router</span>);
        }
        <span class="this">this</span>.<span class="variable">routes</span>[<span class="variable">method</span>](<span class="variable">path</span>, <span class="variable">fn</span>);
        <span class="keyword">return</span> <span class="this">this</span>;
    };
    <span class="keyword">return</span> <span class="variable">arguments</span>.<span class="variable">callee</span>;
})(<span class="string">'get'</span>)(<span class="string">'post'</span>)(<span class="string">'put'</span>)(<span class="string">'del'</span>);
</code></pre>
</td>
</tr><tr class="filename"><td><h2 id="lib/express/view.js"><a href="#">view</a></h2></td><td>lib/express/view.js</td></tr><tr class="code">
<td class="docs">
<p>Module dependencies.
 </p>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">extname</span> = <span class="variable">require</span>(<span class="string">'path'</span>).<span class="variable">extname</span>,
    <span class="variable">mime</span> = <span class="variable">require</span>(<span class="string">'connect/utils'</span>).<span class="variable">mime</span>,
    <span class="variable">utils</span> = <span class="variable">require</span>(<span class="string">'connect/utils'</span>),
    <span class="variable">http</span> = <span class="variable">require</span>(<span class="string">'http'</span>),
    <span class="variable">sys</span> = <span class="variable">require</span>(<span class="string">'sys'</span>),
    <span class="variable">fs</span> = <span class="variable">require</span>(<span class="string">'fs'</span>);</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Cache supported template engine exports to
increase performance by lowering the number
of calls to <code>require()</code>.</p>

<ul><li><p><strong>type</strong>: <em>Object</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">cache</span> = {};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Cache view contents to prevent I/O hits.</p>

<ul><li><p><strong>type</strong>: <em>Object</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="keyword">var</span> <span class="variable">viewCache</span> = {};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Register the given template engine <code>exports</code>
as <code>ext</code>. For example we may wish to map ".html"
files to jade:</p>

<p>   app.register('.html', require('jade'));</p>

<p>This is also useful for libraries that may not
match extensions correctly. For example my haml.js
library is installed from npm as "hamljs" so instead
of layout.hamljs, we can register the engine as ".haml":</p>

<p>   app.register('.haml', require('haml-js'));</p>

<p>For engines that do not comply with the Express
specification, we can also wrap their api this way.</p>

<p>   app.register('.foo', {
       render: function(str, options) {
           // perhaps their api is
           // foo.toHTML(str, options);
       }
   });</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  ext</p></li><li><p><strong>param</strong>: <em>Object</em>  obj</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">exports</span>.<span class="variable">register</span> = <span class="keyword">function</span>(<span class="variable">ext</span>, <span class="variable">exports</span>) {
    <span class="variable">cache</span>[<span class="variable">ext</span>] = <span class="variable">exports</span>;
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Render <code>view</code> partial with the given <code>options</code>.</p>

<h2>Options</h2>

<ul><li><p><code>object</code> Single object with name derived from the view (unless <code>as</code> is present) </p></li><li><p><code>as</code> Variable name for each <code>collection</code> value, defaults to the view name.</p><ul><li>as: 'something' will add the <code>something</code> local variable</li><li>as: this will use the collection value as the template context</li><li><p>as: global will merge the collection value's properties with <code>locals</code></p></li></ul></li><li><p><code>collection</code> Array of objects, the name is derived from the view name itself. 
For example <em>video.html</em> will have a object <em>video</em> available to it.</p></li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  view</p></li><li><p><strong>param</strong>: <em>Object | Array</em>  options or collection</p></li><li><p><strong>return</strong>: <em>String</em> </p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">partial</span> = <span class="keyword">function</span>(<span class="variable">view</span>, <span class="variable">options</span>, <span class="variable">ext</span>){
    <span class="comment">// Inherit parent view extension when not present</span>
    <span class="keyword">if</span> (<span class="variable">ext</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">view</span>.<span class="variable">indexOf</span>(<span class="string">'.'</span>) &<span class="variable">lt</span>; <span class="number integer">0</span>) {
        <span class="variable">view</span> += <span class="variable">ext</span>;
    }

    <span class="comment">// Allow collection to be passed as second param</span>
    <span class="keyword">if</span> (<span class="class">Array</span>.<span class="variable">isArray</span>(<span class="variable">options</span>)) {
        <span class="variable">options</span> = { <span class="variable">collection</span>: <span class="variable">options</span> };
    }

    <span class="comment">// Defaults</span>
    <span class="variable">options</span> = <span class="variable">options</span> || {};
    <span class="variable">options</span>.<span class="variable">locals</span> = <span class="variable">options</span>.<span class="variable">locals</span> || {};
    <span class="variable">options</span>.<span class="variable">partial</span> = <span class="variable">true</span>;
    <span class="variable">options</span>.<span class="variable">layout</span> = <span class="variable">false</span>;

    <span class="comment">// Collection support</span>
    <span class="keyword">var</span> <span class="variable">collection</span> = <span class="variable">options</span>.<span class="variable">collection</span>;
    <span class="keyword">if</span> (<span class="variable">collection</span>) {
        <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">options</span>.<span class="variable">as</span> || <span class="variable">view</span>.<span class="variable">split</span>(<span class="string">'.'</span>)[<span class="number integer">0</span>],
            <span class="variable">len</span> = <span class="variable">collection</span>.<span class="variable">length</span>;
        <span class="keyword">delete</span> <span class="variable">options</span>.<span class="variable">collection</span>;
        <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">collectionLength</span> = <span class="variable">len</span>;
        <span class="keyword">return</span> <span class="variable">collection</span>.<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">val</span>, <span class="variable">i</span>){
            <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">firstInCollection</span> = <span class="variable">i</span> === <span class="number integer">0</span>;
            <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">indexInCollection</span> = <span class="variable">i</span>;
            <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">lastInCollection</span> = <span class="variable">i</span> === <span class="variable">len</span> - <span class="number integer">1</span>;
            <span class="variable">options</span>.<span class="variable">object</span> = <span class="variable">val</span>;
            <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">partial</span>(<span class="variable">view</span>, <span class="variable">options</span>);
        }, <span class="this">this</span>).<span class="variable">join</span>(<span class="string">''</span>);
    } <span class="keyword">else</span> {
        <span class="keyword">if</span> (<span class="variable">options</span>.<span class="variable">object</span>) {
            <span class="keyword">var</span> <span class="variable">name</span> = <span class="variable">options</span>.<span class="variable">as</span> || <span class="variable">view</span>.<span class="variable">split</span>(<span class="string">'.'</span>)[<span class="number integer">0</span>];
            <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">name</span> === <span class="string">'string'</span>) {
                <span class="variable">options</span>.<span class="variable">locals</span>[<span class="variable">name</span>] = <span class="variable">options</span>.<span class="variable">object</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">name</span> === <span class="variable">global</span>) {
                <span class="variable">utils</span>.<span class="variable">merge</span>(<span class="variable">options</span>.<span class="variable">locals</span>, <span class="variable">options</span>.<span class="variable">object</span>);
            } <span class="keyword">else</span> {
                <span class="variable">options</span>.<span class="variable">context</span> = <span class="variable">options</span>.<span class="variable">object</span>;
            }
        }
        <span class="keyword">return</span> <span class="this">this</span>.<span class="variable">render</span>(<span class="variable">view</span>, <span class="variable">options</span>);
    }
};</code></pre>
</td>
</tr>
<tr class="code">
<td class="docs">
<p>Render <code>view</code> with the given <code>options</code> and optional callback <code>fn</code>.
When a callback function is given a response will <em>not</em> be made
automatically, however otherwise a response of <em>200</em> and <em>text/html</em> is given.</p>

<h2>Options</h2>

<p> Most engines accept one or more of the following options,
 both <em>haml</em> and <em>jade</em> accept all:</p>

<ul><li><code>context|scope</code>   Template evaluation context (<code>this</code>)</li><li><code>locals</code>    Object containing local variables</li><li><code>debug</code>     Output debugging information</li></ul>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  view</p></li><li><p><strong>param</strong>: <em>Object | Function</em>  options or callback function</p></li><li><p><strong>param</strong>: <em>Function</em>  fn</p></li><li><p><strong>api</strong>: <em>public</em></p></li></ul>
</td>
<td class="code">
<pre><code><span class="variable">http</span>.<span class="class">ServerResponse</span>.<span class="variable">prototype</span>.<span class="variable">render</span> = <span class="keyword">function</span>(<span class="variable">view</span>, <span class="variable">options</span>, <span class="variable">fn</span>){
    <span class="comment">// Support callback function as second arg</span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">options</span> === <span class="string">'function'</span>) {
        <span class="variable">fn</span> = <span class="variable">options</span>, <span class="variable">options</span> = {};
    }
    
    <span class="keyword">var</span> <span class="variable">options</span> = <span class="variable">options</span> || {},
        <span class="variable">viewOptions</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'view options'</span>),
        <span class="variable">defaultEngine</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'view engine'</span>);

    <span class="comment">// Mixin &quot;view options&quot;</span>
    <span class="keyword">if</span> (<span class="variable">viewOptions</span>) <span class="variable">options</span>.<span class="variable">__proto__</span> = <span class="variable">viewOptions</span>;

    <span class="comment">// Support &quot;view engine&quot; setting</span>
    <span class="keyword">if</span> (<span class="variable">view</span>.<span class="variable">indexOf</span>(<span class="string">'.'</span>) &<span class="variable">lt</span>; <span class="number integer">0</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">defaultEngine</span>) {
        <span class="variable">view</span> += <span class="string">'.'</span> + <span class="variable">defaultEngine</span>;
    }

    <span class="comment">// Defaults</span>
    <span class="keyword">var</span> <span class="variable">self</span> = <span class="this">this</span>,
        <span class="variable">helpers</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">viewHelpers</span>,
        <span class="variable">dynamicHelpers</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">dynamicViewHelpers</span>,
        <span class="variable">root</span> = <span class="variable">viewRoot</span>(<span class="this">this</span>.<span class="variable">app</span>),
        <span class="variable">ext</span> = <span class="variable">extname</span>(<span class="variable">view</span>),
        <span class="variable">partial</span> = <span class="variable">options</span>.<span class="variable">partial</span>,
        <span class="variable">layout</span> = <span class="variable">options</span>.<span class="variable">layout</span> === <span class="variable">undefined</span> ? <span class="variable">true</span> : <span class="variable">options</span>.<span class="variable">layout</span>,
        <span class="variable">layout</span> = <span class="variable">layout</span> === <span class="variable">true</span>
            ? <span class="string">'layout'</span> + <span class="variable">ext</span>
            : <span class="variable">layout</span>;

    <span class="comment">// Allow layout name without extension</span>
    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">layout</span> === <span class="string">'string'</span> &<span class="variable">amp</span>;&<span class="variable">amp</span>; <span class="variable">layout</span>.<span class="variable">indexOf</span>(<span class="string">'.'</span>) &<span class="variable">lt</span>; <span class="number integer">0</span>) {
        <span class="variable">layout</span> += <span class="variable">ext</span>;
    }

    <span class="comment">// Normalize &quot;context&quot; to &quot;scope&quot;, defaulting to this response</span>
    <span class="variable">options</span>.<span class="variable">scope</span> = <span class="variable">options</span>.<span class="variable">scope</span> || <span class="variable">options</span>.<span class="variable">context</span> || <span class="this">this</span>;

    <span class="comment">// Auto-cache in production</span>
    <span class="keyword">if</span> (<span class="this">this</span>.<span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'env'</span>) === <span class="string">'production'</span>) {
        <span class="variable">options</span>.<span class="variable">cache</span> = <span class="variable">true</span>;
    }

    <span class="comment">// Partials support</span>
    <span class="keyword">if</span> (<span class="variable">options</span>.<span class="variable">partial</span>) {
        <span class="variable">root</span> = <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'partials'</span>)
            ? <span class="this">this</span>.<span class="variable">app</span>.<span class="variable">set</span>(<span class="string">'partials'</span>)
            : <span class="variable">root</span> + <span class="string">'/partials'</span>;
    }

    <span class="comment">// View path</span>
    <span class="keyword">var</span> <span class="variable">path</span> = <span class="variable">view</span>[<span class="number integer">0</span>] === <span class="string">'/'</span>
        ? <span class="variable">view</span>
        : <span class="variable">root</span> + <span class="string">'/'</span> + <span class="variable">view</span>;

    <span class="comment">// Pass filename to the engine and view</span>
    <span class="variable">options</span>.<span class="variable">locals</span> = <span class="variable">options</span>.<span class="variable">locals</span> || {};
    <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">__filename</span> = <span class="variable">options</span>.<span class="variable">filename</span> = <span class="variable">path</span>;

    <span class="comment">// Dynamic helper support</span>
    <span class="keyword">if</span> (<span class="variable">options</span>.<span class="variable">dynamicHelpers</span> !== <span class="variable">false</span>) {
        <span class="keyword">var</span> <span class="variable">keys</span> = <span class="class">Object</span>.<span class="variable">keys</span>(<span class="variable">dynamicHelpers</span>);
        <span class="keyword">for</span> (<span class="keyword">var</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">len</span> = <span class="variable">keys</span>.<span class="variable">length</span>; <span class="variable">i</span> &<span class="variable">lt</span>; <span class="variable">len</span>; ++<span class="variable">i</span>) {
            <span class="keyword">var</span> <span class="variable">key</span> = <span class="variable">keys</span>[<span class="variable">i</span>],
                <span class="variable">val</span> = <span class="variable">dynamicHelpers</span>[<span class="variable">key</span>];
            <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable">val</span> === <span class="string">'function'</span>) {
                <span class="variable">helpers</span>[<span class="variable">key</span>] = <span class="variable">val</span>.<span class="variable">call</span>(
                    <span class="this">this</span>.<span class="variable">app</span>, 
                    <span class="this">this</span>.<span class="variable">req</span>, 
                    <span class="this">this</span>);
            }
        }
    }

    <span class="comment">// Always expose partial() as a local</span>
    <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">partial</span> = <span class="keyword">function</span>(<span class="variable">view</span>, <span class="variable">options</span>){
        <span class="keyword">return</span> <span class="variable">self</span>.<span class="variable">partial</span>.<span class="variable">call</span>(<span class="variable">self</span>, <span class="variable">view</span>, <span class="variable">options</span>, <span class="variable">ext</span>);
    };
    
    <span class="comment">// Merge view helpers</span>
    <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">__proto__</span> = <span class="variable">helpers</span>;

    <span class="keyword">function</span> <span class="variable">error</span>(<span class="variable">err</span>) {
        <span class="keyword">if</span> (<span class="variable">fn</span>) {
            <span class="variable">fn</span>(<span class="variable">err</span>);
        } <span class="keyword">else</span> {
            <span class="variable">self</span>.<span class="variable">req</span>.<span class="variable">next</span>(<span class="variable">err</span>);
        }
    }

    <span class="comment">// Cache contents</span>
    <span class="keyword">try</span> {
        <span class="keyword">var</span> <span class="variable">str</span> = (<span class="variable">options</span>.<span class="variable">cache</span> ? <span class="variable">viewCache</span>[<span class="variable">path</span>] : <span class="keyword">null</span>) || <span class="variable">cacheViewSync</span>(<span class="variable">path</span>);
    } <span class="keyword">catch</span> (<span class="variable">err</span>) {
        <span class="keyword">return</span> <span class="variable">error</span>(<span class="variable">err</span>);
    }

    <span class="comment">// Cache template engine exports</span>
    <span class="keyword">var</span> <span class="variable">engine</span> = <span class="variable">cache</span>[<span class="variable">ext</span>] || (<span class="variable">cache</span>[<span class="variable">ext</span>] = <span class="variable">require</span>(<span class="variable">ext</span>.<span class="variable">substr</span>(<span class="number integer">1</span>)));

    <span class="comment">// Attempt render</span>
    <span class="keyword">try</span> {
        <span class="keyword">var</span> <span class="variable">str</span> = <span class="variable">engine</span>.<span class="variable">render</span>(<span class="variable">str</span>, <span class="variable">options</span>);
    } <span class="keyword">catch</span> (<span class="variable">err</span>) {
        <span class="keyword">return</span> <span class="variable">error</span>(<span class="variable">err</span>);
    }

    <span class="comment">// Layout support</span>
    <span class="keyword">if</span> (<span class="variable">layout</span>) {
        <span class="variable">options</span>.<span class="variable">layout</span> = <span class="variable">false</span>;
        <span class="variable">options</span>.<span class="variable">locals</span>.<span class="variable">body</span> = <span class="variable">str</span>;
        <span class="variable">options</span>.<span class="variable">isLayout</span> = <span class="variable">true</span>;
        <span class="variable">self</span>.<span class="variable">render</span>(<span class="variable">layout</span>, <span class="variable">options</span>, <span class="variable">fn</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">partial</span>) {
        <span class="keyword">return</span> <span class="variable">str</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">fn</span>) {
        <span class="variable">fn</span>(<span class="keyword">null</span>, <span class="variable">str</span>);
    } <span class="keyword">else</span> {
        <span class="variable">self</span>.<span class="variable">send</span>(<span class="variable">str</span>);
    }
};
</code></pre>
</td>
</tr>	</body>
</html></tbody></table>